<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.88e9b265201cfa597d0f.css" id="gatsby-global-css">@font-face{font-family:et-book;src:url(/static/et-book-roman-line-figures-b19f46f303d02748059251cee2aa6abb.eot);src:url(/static/et-book-roman-line-figures-b19f46f303d02748059251cee2aa6abb.eot?#iefix) format("embedded-opentype"),url(/static/et-book-roman-line-figures-10d6df6a575fb60ab98d2a7d3792642a.woff) format("woff"),url(/static/et-book-roman-line-figures-d54d0bf6aa7fcf3279d8812acb322c06.ttf) format("truetype"),url(/static/et-book-roman-line-figures-f5cdc02ed1cefd2255d254a77c64b7bd.svg#etbookromanosf) format("svg");font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:et-book;src:url(/static/et-book-display-italic-old-style-figures-a47b89787a4f7491180c40ec69d57998.eot);src:url(/static/et-book-display-italic-old-style-figures-a47b89787a4f7491180c40ec69d57998.eot?#iefix) format("embedded-opentype"),url(/static/et-book-display-italic-old-style-figures-43eb7a3417177f8f0fff766082379da5.woff) format("woff"),url(/static/et-book-display-italic-old-style-figures-d6175af437d22f14e7cf64c370adc879.ttf) format("truetype"),url(/static/et-book-display-italic-old-style-figures-0692c0388390239d27fd414060b46df3.svg#etbookromanosf) format("svg");font-weight:400;font-style:italic;font-display:swap}@font-face{font-family:et-book;src:url(/static/et-book-bold-line-figures-7ed918f3e796962afd05f4a02fb3f84f.eot);src:url(/static/et-book-bold-line-figures-7ed918f3e796962afd05f4a02fb3f84f.eot?#iefix) format("embedded-opentype"),url(/static/et-book-bold-line-figures-1c130d09324dbeb3ba2e5a2f9d788a6f.woff) format("woff"),url(/static/et-book-bold-line-figures-5294d5d521aab523c8acd8ac96cfe4c0.ttf) format("truetype"),url(/static/et-book-bold-line-figures-13c073673fed13df2e115720aa3de09a.svg#etbookromanosf) format("svg");font-weight:700;font-style:normal;font-display:swap}@font-face{font-family:et-book-roman-old-style;src:url(/static/et-book-roman-old-style-figures-fc7b0f1d982d0029eacba5dd89bf8562.eot);src:url(/static/et-book-roman-old-style-figures-fc7b0f1d982d0029eacba5dd89bf8562.eot?#iefix) format("embedded-opentype"),url(/static/et-book-roman-old-style-figures-b1b6ddd0b0609c451978017ef81d11b9.woff) format("woff"),url(/static/et-book-roman-old-style-figures-638c7cda0684c1644411d3849e61995f.ttf) format("truetype"),url(/static/et-book-roman-old-style-figures-3885093b224ae98aa11a95c8882f1177.svg#etbookromanosf) format("svg");font-weight:400;font-style:normal;font-display:swap}html{font-size:15px}body{width:87.5%;margin-left:auto;margin-right:auto;padding-left:12.5%;font-family:et-book,Palatino,Palatino Linotype,Palatino LT STD,Book Antiqua,Georgia,serif;background-color:#fffff8;color:#111;max-width:1400px;counter-reset:sidenote-counter}@media (prefers-color-scheme:dark){body{background-color:#151515;color:#ddd}}h1{font-weight:400;margin-top:4rem;margin-bottom:1.5rem;font-size:3.2rem;line-height:1}h2{margin-top:2.1rem;font-size:2.2rem}h2,h3{font-style:italic;font-weight:400;margin-bottom:1.4rem;line-height:1}h3{font-size:1.7rem;margin-top:2rem}hr{display:block;height:1px;width:55%;border:0;border-top:1px solid #ccc;margin:1em 0;padding:0}p.subtitle{font-style:italic;margin-top:1rem;margin-bottom:1rem;font-size:1.8rem;display:block;line-height:1}.numeral{font-family:et-book-roman-old-style}.danger{color:red}article{padding:5rem 0}section{padding-top:1rem;padding-bottom:1rem}dl,ol,p,ul{font-size:1.4rem;line-height:2rem}p{margin-top:1.4rem;margin-bottom:1.4rem;padding-right:0;vertical-align:baseline}div.epigraph{margin:5em 0}div.epigraph>blockquote{margin-top:3em;margin-bottom:3em}div.epigraph>blockquote,div.epigraph>blockquote>p{font-style:italic}div.epigraph>blockquote>footer{font-style:normal}div.epigraph>blockquote>footer>cite{font-style:italic}blockquote{font-size:1.4rem}blockquote p{width:55%;margin-right:40px}blockquote footer{width:55%;font-size:1.1rem;text-align:right}section>footer,section>p,section>table{width:55%}section>dl,section>ol,section>ul{width:50%;-webkit-padding-start:5%}dt:not(:first-child),li:not(:first-child){margin-top:.25rem}figure{padding:0;border:0;font-size:100%;font:inherit;max-width:55%;-webkit-margin-start:0;-webkit-margin-end:0;margin:0 0 3em}figcaption,figure{vertical-align:baseline}figcaption{float:right;clear:right;margin-top:0;margin-bottom:0;font-size:1.1rem;line-height:1.6;position:relative;max-width:40%}figure.fullwidth figcaption{margin-right:24%}a:link,a:visited{color:inherit}.no-tufte-underline:link{background:unset;text-shadow:unset}.hover-tufte-underline:hover,.tufte-underline,a:link{text-decoration:none;background:linear-gradient(#fffff8,#fffff8),linear-gradient(#fffff8,#fffff8),linear-gradient(currentColor,currentColor);background-size:.05em 1px,.05em 1px,1px 1px;background-repeat:no-repeat,no-repeat,repeat-x;text-shadow:.03em 0 #fffff8,-.03em 0 #fffff8,0 .03em #fffff8,0 -.03em #fffff8,.06em 0 #fffff8,-.06em 0 #fffff8,.09em 0 #fffff8,-.09em 0 #fffff8,.12em 0 #fffff8,-.12em 0 #fffff8,.15em 0 #fffff8,-.15em 0 #fffff8;background-position:0 93%,100% 93%,0 93%}@media screen and (-webkit-min-device-pixel-ratio:0){.hover-tufte-underline:hover,.tufte-underline,a:link{background-position-y:87%,87%,87%}}@media (prefers-color-scheme:dark){.hover-tufte-underline:hover,.tufte-underline,a:link{text-shadow:.03em 0 #151515,-.03em 0 #151515,0 .03em #151515,0 -.03em #151515,.06em 0 #151515,-.06em 0 #151515,.09em 0 #151515,-.09em 0 #151515,.12em 0 #151515,-.12em 0 #151515,.15em 0 #151515,-.15em 0 #151515}}a:link::-moz-selection,a:link::selection{text-shadow:.03em 0 #b4d5fe,-.03em 0 #b4d5fe,0 .03em #b4d5fe,0 -.03em #b4d5fe,.06em 0 #b4d5fe,-.06em 0 #b4d5fe,.09em 0 #b4d5fe,-.09em 0 #b4d5fe,.12em 0 #b4d5fe,-.12em 0 #b4d5fe,.15em 0 #b4d5fe,-.15em 0 #b4d5fe;background:#b4d5fe}img{max-width:100%}.marginnote,.sidenote{float:right;clear:right;margin-right:-60%;width:50%;margin-top:.3rem;margin-bottom:0;font-size:1.1rem;line-height:1.3;vertical-align:baseline;position:relative}.sidenote-number{counter-increment:sidenote-counter}.sidenote-number:after,.sidenote:before{font-family:et-book-roman-old-style;position:relative;vertical-align:baseline}.sidenote-number:after{content:counter(sidenote-counter);font-size:1rem;top:-.5rem;left:.1rem}.sidenote:before{content:counter(sidenote-counter) " ";font-size:1rem;top:-.5rem}blockquote .marginnote,blockquote .sidenote{margin-right:-82%;min-width:59%;text-align:left}div.fullwidth,table.fullwidth{width:100%}div.table-wrapper{overflow-x:auto;font-family:Trebuchet MS,Gill Sans,Gill Sans MT,sans-serif}.sans{font-family:Gill Sans,Gill Sans MT,Calibri,sans-serif;letter-spacing:.03em}code,pre>code{font-family:Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:1rem;line-height:1.42;-webkit-text-size-adjust:100%}.sans>code{font-size:1.2rem}h1>code,h2>code,h3>code{font-size:.8em}.marginnote>code,.sidenote>code{font-size:1rem}pre>code{font-size:.9rem;width:52.5%;margin-left:2.5%;overflow-x:auto;display:block}pre.fullwidth>code{width:90%}.fullwidth{max-width:90%;clear:both}span.newthought{font-variant:small-caps;font-size:1.2em}input.margin-toggle{display:none}label.sidenote-number{display:inline-block;max-height:2rem}label.margin-toggle:not(.sidenote-number){display:none}.iframe-wrapper{position:relative;padding-bottom:56.25%;padding-top:25px;height:0}.iframe-wrapper iframe{position:absolute;top:0;left:0;width:100%;height:100%}@media (max-width:760px){body{width:84%;padding-left:8%;padding-right:8%}hr,section>footer,section>p,section>table{width:100%}pre>code{width:97%}section>dl,section>ol,section>ul{width:90%}figure{max-width:90%}figcaption,figure.fullwidth figcaption{margin-right:0;max-width:none}blockquote{margin-left:1.5em;margin-right:0}blockquote footer,blockquote p{width:100%}label.margin-toggle:not(.sidenote-number){display:inline}.marginnote,.sidenote{display:none}.margin-toggle:checked+.marginnote,.margin-toggle:checked+.sidenote{display:block;float:left;left:1rem;clear:both;width:95%;margin:1rem 2.5%;vertical-align:baseline;position:relative}label{cursor:pointer}div.table-wrapper,table{width:85%}img{width:100%}}</style><meta name="generator" content="Gatsby 2.32.13"/><title data-react-helmet="true"></title><link as="script" rel="preload" href="/webpack-runtime-969c07431224231c0f8f.js"/><link as="script" rel="preload" href="/framework-3e6dec6139dadaa7d0c7.js"/><link as="script" rel="preload" href="/styles-9411612e31e4f14527d1.js"/><link as="script" rel="preload" href="/app-c474f2b04f2725bec8ba.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-9c3ee7bf412a007fbf2c.js"/><link as="fetch" rel="preload" href="/page-data/march-recap/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><a style="font-size:1.6rem" href="/">‚Üê Back home</a><h1>March Tech Recap</h1><style data-emotion-css="wvcn4j">.css-wvcn4j{margin-top:10px;color:#606060;}</style><h3 class="css-wvcn4j elc5l150">08 April, 2020<!-- --> - <!-- -->5 min read</h3><style data-emotion-css="iujih3">.css-iujih3 pre > code{width:inherit;}</style><div class="css-iujih3 elc5l151"><p>Hey everyone. We shipped a bunch of new stuff in March. I want to highlight a few under-the-hood improvements you may have missed. Our big focus was playback issues on lbry.tv and we also made some protocol improvements. Let's start at the top of the stack and work our way down.</p>
<p><img src="https://spee.ch/c/BPSxQsKgua6N0NB4I8z6VmnQ.jpeg" alt=""></p>
<h2>lbry.tv Kubernetes cluster</h2>
<p>lbry.tv has been growing like wild over the last few months. To keep up with the increasing load, we moved the app to a Kubernetes cluster that is easy to scale up as demand spikes. The cluster runs a bunch of <a href="https://github.com/lbryio/lbry-sdk">LBRY SDK</a> instances, a <a href="https://github.com/lbryio/lbrytv">proxy</a> in front of them to handle authentication and wallet loading, a database for the proxy, plus monitoring and alerting (Prometheus + Grafana).</p>
<p>So far k8s has really delivered on its promise. Our <a href="https://en.wikipedia.org/wiki/Apdex">apdex</a> scores (the most holistic metric we track for lbrytv) have been consistently great and we had no trouble handling almost 900 simultaneous streams, whereas a month ago 150 streams would have crushed the app.</p>
<p>That's not to say that lbry.tv has been perfect. We did have some downtime and slowness in March. But we've eliminated a whole class of problems and can focus our efforts on the next lowest-hanging fruit.</p>
<h2>Distributed lbry.tv Players</h2>
<p>In addition to moving to the k8s cluster, we split out the code that downloads and serves the LBRY streams into its own codebase and set up instances in a few locations around the world (two in the US and two in Europe for now). The player caches acts as a video CDN, caching streams and serving them from a closer location. This makes videos start faster for more users.</p>
<h2>Video Transcoding</h2>
<p>As we wrote in the <a href="lbry://@lbrytech/buffering">post on buffering</a>, high-quality videos are often unstreamable because the video bitrate is higher than your bandwidth. The solution is transcoding the video down to a reasonable size before uploading it, and now that's as easy as passing a flag to the <code>publish</code> command (and automatic in our apps). One caveat is that using the flag requires that ffmpeg is installed on your system. In the future we may remove this dependency.</p>
<p>If you want to know what's going on under the hood, <a href="https://github.com/lbryio/lbry-sdk/blob/master/lbry/file_analysis.py#L410">here's the source</a>.</p>
<h2>On-Demand Header Download</h2>
<p>Our biggest protocol improvement in March was a huge boost to the header download process. Any client that doesn't have a full copy of the blockchain (and that's most of our clients) needs at least the headers to verify transactions and URL resolution. Without headers, you are trusting that the wallet server is not lying to you or withholding information (and if you're doing that, what's the point of using a blockchain?). The problem is that our headers are at 80MB right now, and will only get bigger. Downloading them the first time the app runs is a terrible experience for the users (its the cause of the infamous "catching up..." green screen), and may be prohibitive on low-bandwidth connections.</p>
<p>The solution we came up with is something we call "on-demand header download". It means the SDK will request and download the headers it needs right when it needs them. With this feature, the SDK starts pretty much instantly since startup is no longer blocked by header download.</p>
<p>In addition, we finally got rid of several hacks. On Android, we used to bundle the headers right into the APK. No need to do that anymore, and very timely - we were about to hit the 100MB file size limit on Play Store apps. We also stopped keeping an always-up-to-date headers file in S3, since there are no longer any speed benefits to downloading the headers from there.</p>
<h2>BitTorrent MVP</h2>
<p>This one has the smallest impact on users today, but the biggest potential for LBRY down the road. The latest SDKs are now part of the BitTorrent network, and can download torrents published to LBRY</p>
<p>The integration is seamless. Here's <a href="lbry://@lbry:3f/bt-lbry?t=50">Jeremy's demo</a>. The stream he downloads has a BitTorrent infohash in its metadata instead of a lbry sd_hash. If you wanna see it in action on the command line (or at the <a href="https://lbry.tech/playground">playground</a>), resolve <code>lbry://bigbuckbunny-torrent1</code>. You'll see this in the source:</p>
<pre><code>source: {
    bt_infohash: "dd8255ecdc7ca55fb0bbf81323d87062db1f6d1c",
    hash: "1f4dc7dfd0407801552d46a400e4d610b4fc14df896f7fb7769e02182d7ac2635938172055e97fca577b15eb6e78f459",
    media_type: "video/mp4",
    name: "Big Buck Bunny.mp4",
    size: "276134947"
},
</code></pre>
<p>When you call <code>get</code> on this URL (as you would on any video you want to watch), the SDK will connect to BitTorrent using <a href="https://www.libtorrent.org/">libtorrent</a>, look up the infohash, and download the video. Simple!</p>
<h2>And More</h2>
<p>I talked about only a few of the things we did last month. In total, we merged 196 PRs from 49 users, across 34 LBRY repos. Thank you contriutors! I wanna shout out all of you here:</p>
<p>AlessandroSpallina, Bharat123rox, BrannonKing, Coolguy3289, EricBrianAnil, GlenCooper, MarcoFalke, Meantub, PeterMortensen, PierreRochard, SwapzoneIO, achow101, addy1510, adityakaria, akinwale, andybeletsky, apetresc, bvbfan, ceoger, eggplantbren, eukreign, finer9, gahag, gustavonalle, gwillen, gy741, harding, hebasto, instagibbs, jackrobison, jessopb, jring-o, jsigwart, kauffj, kcseb, ken2812221, laanwj, lbrynaut, lyoshenka, nikooo777, osilkin98, promag, ryanofsky, sdaftuar, seanyesmunt, shyba, tiger5226, tzarebczan, ykris45.</p></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/march-recap";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-8296ab92a56f464716e4.js"],"app":["/app-c474f2b04f2725bec8ba.js"],"component---src-pages-404-js":["/component---src-pages-404-js-57a9046ee816fc279f05.js"],"component---src-pages-index-js":["/component---src-pages-index-js-2ac4fa1a3f0a1ae191c4.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-9c3ee7bf412a007fbf2c.js"]};/*]]>*/</script><script src="/polyfill-8296ab92a56f464716e4.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-9c3ee7bf412a007fbf2c.js" async=""></script><script src="/app-c474f2b04f2725bec8ba.js" async=""></script><script src="/styles-9411612e31e4f14527d1.js" async=""></script><script src="/framework-3e6dec6139dadaa7d0c7.js" async=""></script><script src="/webpack-runtime-969c07431224231c0f8f.js" async=""></script></body></html>